#!/usr/bin/env bash
set -euo pipefail

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRT)

if [[ -z "$STAGED_FILES" ]]; then
  exit 0
fi

# Cairo (Scarb)
if echo "$STAGED_FILES" | grep -qE '\.cairo$|^Scarb\.(toml|lock)$|^dojo_.*\.toml$'; then
  echo 'Running Cairo checks...'
  if scarb fmt --check >/dev/null 2>&1; then
    scarb fmt --check
  else
    echo 'Skipping format check: `scarb fmt --check` not supported by this Scarb version.'
  fi
  scarb build
  scarb test
fi


echo 'Pre-commit checks complete.'
